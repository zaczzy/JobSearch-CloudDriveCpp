#include "servercommon.h"
#include "cookierelay.h"

/*
 * Constructor
 */
CookieRelay::CookieRelay(int sock): sock(sock){
	//SETUP LOADBALANCER SOCK HERE
	latestCookie = -1;
	mutex_sock = PTHREAD_MUTEX_INITIALIZER;
}

/*
 * Nothing to see here
 */
CookieRelay::~CookieRelay() {
//	                               .....
//	                            ...........
//	                           .. ..........    ........
//	                        ,,.... @@@@@%...,*.*@@@@@.....
//	                   *,/#%%#,....@@@@@@..,/..(@@@@.......
//	               /,/((#%#%&,.....%(..,,,(,.............
//	            ,(/#(((((%####(###((/,,,*(%##,,............/
//	           *##%/#(###%#(((#((%%###%&%%#%%#%*...,......(((///
//	           %%%%#%#%%%%###%#%%%(%%##%######&(#((/*%#(%###//#/.
//	         ,*#&%((%##%%%#%##%%#(%(#(%#%###%#%%%##%%##(#(#*(#(#*/.
//	          *(%%&&(%#%#%%##%&%(####%%%&&%#%#%###((%##((##((/,
//	         *#/%&&@@@@@@@%%%%%%%%%%%#%%%#%%%%%#(%%%%#(#&%%%%%%((*/**
//	        ((#%%%&@@@@@@@@@@@@@@@@@@@@&%%%&%&%###%&%###&%%%%%##((#//*
//	        /##%%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%&%%%%%%%&&(%%###///,
//	        .#%%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&%%%%%%%%#(%##*,
//	      .*(#%%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%#%#/
//	       ,/##%%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%#(#*
//	        ,##%%%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%,(
//	        ,(##%%&%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%(.
//	        ..(#%%%%%%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%#/*
//	        #%%(%%%%%#%%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%&%%%###,,
//	       /%%%&%#%(&%%%%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%&%%%&&%#(/
//	      .(%%%#%#&&&%&&&&%%&&@@@@@@@@@@&@@@@@@&%%&&&%%%%%(##*
//	     *(%%%%&&&%##%%&%&&%#%&&&%%&%&&&%%&%%&&%%&%%&&%%%%#%&(////*****//
//	   *(,%%&&&%&*#%%%%%&&&%&%%%%%%%#%&%%#%#(%%&&%%&&%%%(***,**/*#%%#(*,
//	   ,#%%&&%&&&&&&&&%&%%#%%&&&%%&@%%%%%%%&%%&%%%&&%&&(#&%%%%(***/*/*,****/**,
//	.*#(%%&&&%&&&&&&&&&&&&&%%&%%%%&%%%%&&%%&&%%%(#&%&&%%%####,/**//*,*/*//*,*,,
//	(%%%&&&&&%&&&&&&&&&&&&%&&%&%&@&&&&&&&%%%%%&%&&&%%%%%%*****%*&******/**/*,,
//	(%&%&&&%%&&&@&&&&&&&@&&&&&&&&&&&&&&%&&%&&&&&&&&&&&&&&/,**///%%%(//,((/******.
//	%&&&%&&&&&%&&&@&&&@&&&&%%@&&&&%#&&%#%&&&%%&%&&&&&&***,**/*,**,(//**#(#((//(**,,
//	#&%&&&%%&&&&&%&%&&%%%%&&&&&@&%&&&&%%%&%&&&&&&%*(**//(/((//#((((#&%###%##/*,
}
/*
 * Generate a cookie for a new browser
 */
int CookieRelay::genCookie(string browser) {
	//race condition?? hopefully not
	cookie2Browser[++latestCookie] = browser;
	return latestCookie;
}

/*
 * Fetch a browser using an existing cookie
 */
string CookieRelay::fetchBrowser(int cookie) {
	return cookie2Browser[cookie];
}
